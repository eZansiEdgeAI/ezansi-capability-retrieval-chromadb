# ezansi-capability-retrieval-chromadb

ChromaDB Retrieval capability for eZansiEdgeAI.

**Contract name:** `chromadb-retrieval`  
**Provides:** `vector-search`, `text-embeddings`  
**Purpose:** Upload content, index it, and query it (RAG retrieval)

## Mental model (LEGO brick)

If you’re a teacher/lecturer or student, think of this repo as **one LEGO brick** in an edge‑AI kit:

- This capability provides the retrieval “brick” (embeddings + ingest/query)
- `capability.json` describes the “studs” (what this brick can do)
- [eZansi Platform Core](https://github.com/eZansiEdgeAI/ezansi-platform-core) is the “baseplate” (one gateway that discovers bricks and routes requests)

For a cold-start checklist (standalone + via the gateway), start here:

## Quickstart Manual Test

- Standalone + via platform-core gateway: [docs/quickstart-manual-test.md](docs/quickstart-manual-test.md)

## Documentation

- Docs index: `docs/README.md`
- Architecture: `docs/architecture.md`
- Deployment: `docs/deployment-guide.md` (and `docs/deployment-guide-raspberry-pi.md`, `docs/deployment-guide-amd64.md`)
- Roadmap: `docs/development-roadmap.md`
- Performance tuning: `docs/performance-tuning.md`
- Troubleshooting: `docs/troubleshooting.md`

## Quick start

```bash
./scripts/deploy.sh --profile pi5  # or: pi4, amd64 (or omit for defaults)
./scripts/validate-deployment.sh

# Ingest
curl -s -X POST http://localhost:8801/collections/demo/documents \
  -H 'Content-Type: application/json' \
  -d '{"documents":[{"id":"doc1","text":"RAG is retrieval augmented generation."}]}' | jq

# Query
curl -s -X POST http://localhost:8801/collections/demo/query \
  -H 'Content-Type: application/json' \
  -d '{"query":"What is RAG?","top_k":3}' | jq

# Embeddings (embedding-only usage)
curl -s -X POST http://localhost:8801/embeddings \
  -H 'Content-Type: application/json' \
  -d '{"texts":["hello world","goodbye world"]}' | jq
```

## Stop / restart

- List running containers for this capability (useful when multiple capabilities are running):

```bash
podman ps --format 'table {{.Names}}\t{{.Status}}\t{{.Ports}}' | grep chromadb-retrieval || true
```

- Stop the stack (keeps volumes/data):

```bash
./scripts/stop.sh --down
```

- Restart the stack:

```bash
podman-compose up -d
```

- Stop and wipe persisted state (Chroma DB + embedding cache):

```bash
podman-compose down
podman volume rm ezansi-capability-retrieval-chromadb_chroma-data
podman volume rm ezansi-capability-retrieval-chromadb_embedding-cache
```

## API

- `GET /health`
- `GET /.well-known/capability.json`
- `POST /embeddings` (embeddings)
- `POST /collections/{collection}/documents` (ingest)
- `POST /collections/{collection}/query` (retrieve)

## Scripts

- `scripts/deploy.sh`: build + start the stack
- `scripts/health-check.sh`: basic health check (used for quick diagnostics)
- `scripts/validate-deployment.sh`: smoke test (health, contract, embeddings, ingest, query)

## Device profiles

This repository includes optional compose override files (similar to other capability repos):

- `podman-compose.pi4.yml`
- `podman-compose.pi5.yml`
- `podman-compose.amd64.yml`

Sizing guidance lives in `config/`.

## Notes

This capability is stack-local and API-only: other containers should call the capability API on port 8801.

ChromaDB runs as an internal service in `podman-compose.yml` and is not published as a host port.

Embeddings are generated by this capability via `fastembed` and may download model files on first run. A persistent cache volume is mounted at `/cache`.

The ChromaDB server image is pinned (see `podman-compose.yml`) to avoid server/client mismatches with the Python `chromadb` client.
